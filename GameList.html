<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="css/amazeui.min.css" />
		<link rel="stylesheet" href="css/admin.css" />
		<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
		<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
		<script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
	</head>
	<body>
		<div class="admin-content-body">
			<div class="am-cf am-padding am-padding-bottom-0">
				<div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">PC所有资源共享</strong><small></small></div>
			</div>
			<hr>
			<div class="am-g">
				<div class="am-u-sm-12 am-u-md-3">
				</div>
				<div class="am-u-sm-12 am-u-md-3">
					<div class="am-input-group am-input-group-sm">
						<input type="text" class="am-form-field">
						<span class="am-input-group-btn">
            <button class="am-btn am-btn-default" type="button">搜索</button>
          </span>
					</div>
				</div>
			</div>
			<div class="am-g">
				<div class="am-u-sm-12">
					<form class="am-form">
						<table class="am-table am-table-hover table-main">
							<thead>
								<tr>
									<th class="table-title">名称</th>
									<th class="table-title">图片</th>
									<th class="table-type">类型</th>
									<th class="table-author am-hide-sm-only">上传者</th>
									<th class="table-date am-hide-sm-only">上传日期</th>
								</tr>
							</thead>
							<tbody>
							
							</tbody>
						</table>
						<div class="am-cf">
						      <div class="am-fr">
						        <ul class="am-pagination">					          
						        </ul>
						      </div>
						</div>
						<hr>
					</form>
				</div>
			</div>
		</div>
	</body>
</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="function.js"></script>
<script>
  $(document).ready(function() {
    var url = getGameListURL();
    var searchInput = $(".am-form-field");
    var searchButton = $(".am-btn-default");
    var tbody = $(".table-main tbody"); // 获取表格的tbody元素
  
    // 发起请求函数
    function sendRequest(searchURL) {
      $.ajax({
        url: searchURL,
        type: "GET",
		data:{"page":1,"limit":10},
        dataType: "json",
        success: function(response) {
          var list = response.data; // 假设接口返回的数据存储在data字段中，是一个数组
          var count = response.extra.count; // 获取总记录数
          var currentPage = response.extra.page; // 获取当前页码
          var pagination = $(".am-pagination"); // 获取分页ul元素
         
           // 清空表格内容
           tbody.empty();
		   
          // 循环处理数据
          for (var i = 0; i < list.length; i++) {
            var game = list[i];
            var row = $("<tr></tr>"); // 创建新的行元素
          
            // 创建单元格元素并设置内容
            var nameCell = $("<td></td>").html("<a href='#'>" + game.game_name + "</a>");
            var imageCell = $("<td></td>");
            var imageElement = $("<img>").attr("src", game.image).css({ width: "200px", height: "100px" });
            var typeCell = $("<td></td>").text(game.type_name);
            var authorCell = $("<td></td>").text(game.name);
            var dateCell = $("<td></td>").text(game.time);
          
            // 将单元格元素添加到行元素中
            row.append(nameCell, imageElement, typeCell, authorCell, dateCell);
          
            // 将行元素添加到表格的tbody中
            tbody.append(row);
          
            // 插入空白行
            var blankRow = $("<tr></tr>").css("height", "10px"); // 创建空白行元素并设置高度为10px
            tbody.append(blankRow);
          }
			// 生成分页项
            generatePagination(count, currentPage);
        }
      });
    }
	
	function generatePagination(count, currentPage) {
	  var pagination = $(".am-pagination");
	  pagination.empty(); // 清空分页项
	
	  var pageCount = Math.ceil(count / 10); // 根据总记录数计算总页数
	
	  // 创建前一页分页项并添加样式和点击事件处理程序
	  var prevLi = $("<li></li>");
	  var prevLink = $("<a></a>").attr("href", "#").text("«").addClass("page-link");
	  prevLi.append(prevLink);
	  pagination.append(prevLi);
	  prevLink.on("click", function() {
	    var page = currentPage - 1; // 前一页页码
	    if (page >= 1) {
	      var searchValue = $(".am-form-field").val(); // 获取输入框的值
	      var searchURL = getGameListURL() + "/game/list?gameName=" + encodeURIComponent(searchValue) + "&page=" + page; // 构建请求URL，将搜索值和页码作为参数
	      sendRequest(searchURL); // 发起请求
	    }
	  });
	
	  for (var i = 1; i <= pageCount; i++) {
	    var li = $("<li></li>"); // 创建 <li> 元素
	    var a = $("<a></a>").attr("href", "#").text(i).addClass("page-link"); // 创建 <a> 元素，并添加 href 和文本内容
	
	    if (i === currentPage) {
	      li.addClass("am-active"); // 当前页添加 active 类
	    }
	
	    li.append(a); // 将 <a> 元素添加到 <li> 元素
	    pagination.append(li); // 将 <li> 元素添加到分页的 <ul> 元素
	
	    // 为分页项的 <a> 元素添加点击事件处理程序
	    a.on("click", function() {
	      var page = parseInt($(this).text()); // 获取点击的页码
	      var searchValue = $(".am-form-field").val(); // 获取输入框的值
	      var searchURL = getGameListURL() + "/game/list?gameName=" + encodeURIComponent(searchValue) + "&page=" + page; // 构建请求URL，将搜索值和页码作为参数
	      sendRequest(searchURL); // 发起请求
	    });
	  }
	
	  // 创建后一页分页项并添加样式和点击事件处理程序
	  var nextLi = $("<li></li>");
	  var nextLink = $("<a></a>").attr("href", "#").text("»").addClass("page-link");
	  nextLi.append(nextLink);
	  pagination.append(nextLi);
	  nextLink.on("click", function() {
	    var page = currentPage + 1; // 后一页页码
	    if (page <= pageCount) {
	      var searchValue = $(".am-form-field").val(); // 获取输入框的值
	      var searchURL = getGameListURL() + "/game/list?gameName=" + encodeURIComponent(searchValue) + "&page=" + page; // 构建请求URL，将搜索值和页码作为参数
	      sendRequest(searchURL); // 发起请求
	    }
	  });
	}

    // 搜索按钮点击事件处理程序
    searchButton.on("click", function() {
      var searchValue = searchInput.val(); // 获取输入框的值
    
      // 构建请求URL，将搜索值作为参数
      var searchURL = url + "/game/list?gameName=" + encodeURIComponent(searchValue);
      
      // 发起请求
      sendRequest(searchURL);
    });
  
    // 默认发起请求
    var defaultURL = url + "/game/list";
    sendRequest(defaultURL);
  });
</script>

